apiVersion: skaffold/v4beta2
kind: Config
metadata:
  name: elkia
build:
  artifacts:
    - image: ghcr.io/infinity-blackhole/elkia-auth
      context: .
      runtimeType: go
      docker:
        target: build
        dockerfile: cmd/elkia-auth/Dockerfile
    - image: ghcr.io/infinity-blackhole/elkia-auth-proxy
      context: .
      runtimeType: go
      docker:
        target: build
        dockerfile: cmd/elkia-auth-proxy/Dockerfile
    - image: ghcr.io/infinity-blackhole/elkia-gateway
      context: .
      runtimeType: go
      docker:
        target: build
        dockerfile: cmd/elkia-gateway/Dockerfile
    - image: ghcr.io/infinity-blackhole/elkia-gateway-proxy
      context: .
      runtimeType: go
      docker:
        target: build
        dockerfile: cmd/elkia-gateway-proxy/Dockerfile
    - image: ghcr.io/infinity-blackhole/elkia-fleet
      context: .
      runtimeType: go
      docker:
        target: build
        dockerfile: cmd/elkia-fleet/Dockerfile
  local:
    useBuildkit: true
manifests:
  kustomize:
    paths:
      - manifests/elkia/overlays/shikanime
    buildArgs:
      - --enable-helm
deploy:
  statusCheckDeadlineSeconds: 600
  tolerateFailuresUntilDeadline: true
profiles:
  - name: debug
    activation:
      - command: debug
    portForward:
      - resourceType: deployment
        resourceName: elkia-auth
        port: 56268
        localPort: 56269
      - resourceType: deployment
        resourceName: elkia-auth-proxy
        port: 56268
        localPort: 56270
      - resourceType: deployment
        resourceName: elkia-gateway
        port: 56268
        localPort: 56271
      - resourceType: deployment
        resourceName: elkia-gateway-proxy
        port: 56268
        localPort: 56272
      - resourceType: deployment
        resourceName: elkia-fleet
        port: 56268
        localPort: 56273
