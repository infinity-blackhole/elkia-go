syntax = "proto3";

package io.elkia.eventing.v1alpha1;

option go_package = "pkg/api/eventing/v1alpha1";

message RequestHandoffMessage {
  string identifier = 2;
  string password = 3;
  string client_version = 5;
  string client_checksum = 7;
}

message GatewayMessage {
  string host = 1;
  string port = 2;
  uint32 population = 3;
  uint32 capacity = 4;
  uint32 world_id = 5;
  uint32 channel_id = 6;
  string world_name = 7;
}

message ProposeHandoffMessage {
  uint32 key = 1;
  repeated GatewayMessage gateways = 2;
}

message PerformHandoffMessage {
  PerformHandoffKeyMessage key_message = 1;
  PerformHandoffPasswordMessage password_message = 2;
}

message PerformHandoffKeyMessage {
  uint32 sequence = 1;
  uint32 key = 2;
}

message PerformHandoffPasswordMessage {
  uint32 sequence = 1;
  string password = 2;
}

message ChannelMessage {
  uint32 sequence = 1;
  oneof payload {
    bytes unknown_message = 2;
    SyncMessage sync_message = 3;
    CommandMessage command_message = 5;
  }
}

message SyncMessage {}

message CommandMessage {
  string opcode = 1;
  oneof payload { bytes unknown_payload = 2; }
}

message AcknowledgeHandoffMessage {
  uint32 key = 1;
  uint32 sequence = 2;
}

enum FailureCode {
  OUTDATED_CLIENT = 0;
  UNEXPECTED_ERROR = 1;
  MAINTENANCE = 2;
  SESSION_ALREADY_USED = 3;
  UNVALID_CREDENTIALS = 4;
  CANT_AUTHENTICATE = 5;
  USER_BLOCKLISTED = 6;
  COUNTRY_BLACKLISTED = 7;
  BAD_CASE = 8;
}

message FailureMessage { FailureCode code = 1; }